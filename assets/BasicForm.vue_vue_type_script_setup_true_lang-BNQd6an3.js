var Re=Object.defineProperty;var Fe=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var we=(n,r,s)=>r in n?Re(n,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[r]=s,_=(n,r)=>{for(var s in r||(r={}))Ne.call(r,s)&&we(n,s,r[s]);if(Fe)for(var s of Fe(r))ke.call(r,s)&&we(n,s,r[s]);return n};var x=(n,r,s)=>new Promise((o,h)=>{var p=c=>{try{g(s.next(c))}catch(u){h(u)}},f=c=>{try{g(s.throw(c))}catch(u){h(u)}},g=c=>c.done?o(c.value):Promise.resolve(c.value).then(p,f);g((s=s.apply(n,r)).next())});import{u as t,g as Ce,c as Y,w as Z,aq as We,y as ve,J as Ve,h as Ke,d as Ue,K as qe,r as Ie,f as J,o as He,Z as de,a7 as Be,a8 as re,k as Te,ae as ce,_ as Xe,aa as pe,ad as Ee,aj as he,ak as me,F as Ye,ac as De,ap as ze}from"./vue-bWmcvXqU.js";import{_ as Ge}from"./FormItem.vue_vue_type_script_lang-vprfBRCQ.js";import{b as Je,c as Ze,_ as Me}from"./BasicForm.vue_vue_type_style_index_0_lang-CNnsnwdM.js";import{h as Qe,i as le,d as Pe,a as et}from"./helper-C-421fQw.js";import{B as U,aA as M,aV as q,ao as tt,F as _e,aP as Oe,aR as ye,d as Le,k as nt}from"./entry/index-C2yXXbfE-1713597257644.js";import{e as ue,l as fe,s as z,aq as Ae,aX as je,d as Q,v as xe,f as G,an as st,a3 as at,ab as ot,al as it,W as rt}from"./antd-D-XvgdAE.js";import{a as ct}from"./index-BYrC6i03.js";function lt(n,r,s){const o=/^\[(.+)\]$/;if(o.test(n)){const h=n.match(o);if(h&&h[1]){const p=h[1].split(",");return r=Array.isArray(r)?r:[r],p.forEach((f,g)=>{z(s,f.trim(),r[g])}),!0}}}function ft(n,r,s){const o=/^\{(.+)\}$/;if(o.test(n)){const h=n.match(o);if(h&&h[1]){const p=h[1].split(",");return r=U(r)?r:{},p.forEach(f=>{z(s,f.trim(),r[f.trim()])}),!0}}}function ut({defaultValueRef:n,getSchema:r,formModel:s,getProps:o}){function h(c){var w,E;if(!U(c))return{};const u={};for(const O of Object.entries(c)){let[,d]=O;const[V]=O;if(!V||M(d)&&d.length===0||ue(d))continue;const m=t(o).transformDateFunc;U(d)&&(d=m==null?void 0:m(d)),M(d)&&((w=d[0])!=null&&w.format)&&((E=d[1])!=null&&E.format)&&(d=d.map(A=>m==null?void 0:m(A))),fe(d)&&(d=d.trim()),!lt(V,d,u)&&!ft(V,d,u)&&z(u,V,d)}return p(u)}function p(c){const u=t(o).fieldMapToTime;if(!u||!Array.isArray(u))return c;for(const[w,[E,O],d="YYYY-MM-DD"]of u){if(!w||!E||!O)continue;if(!Ae(c,w)){je(c,w);continue}const[V,m]=Ae(c,w),[A,b]=Array.isArray(d)?d:[d,d];!Q(V)&&!xe(V)&&z(c,E,f(V,A)),!Q(m)&&!xe(m)&&z(c,O,f(m,b)),je(c,w)}return c}function f(c,u){return u==="timestamp"?q(c).unix():u==="timestampStartDay"?q(c).startOf("day").unix():q(c).format(u)}function g(){const c=t(r),u={};c.forEach(w=>{const{defaultValue:E,defaultValueObj:O}=w,d=Object.keys(O||{});d.length&&d.forEach(V=>{u[V]=O[V],s[V]===void 0&&(s[V]=O[V])}),Q(E)||(u[w.field]=E,s[w.field]===void 0&&(s[w.field]=E))}),n.value=G(u)}return{handleFormValues:h,initDefault:g}}const X=24;function dt({advanceState:n,emit:r,getProps:s,getSchema:o,formModel:h,defaultValueRef:p}){const f=Ce(),{realWidthRef:g,screenEnum:c,screenRef:u}=tt(),w=Y(()=>{if(!n.isAdvanced)return 0;const A=t(s).emptySpan||0;if(st(A))return A;if(U(A)){const{span:b=0}=A,C=t(u);return A[C.toLowerCase()]||b||0}return 0}),E=_e(V,30);Z([()=>t(o),()=>n.isAdvanced,()=>t(g)],()=>{const{showAdvancedButton:A}=t(s);A&&E()},{immediate:!0});function O(A,b=0,C=!1){const D=t(g),S=parseInt(A.md)||parseInt(A.xs)||parseInt(A.sm)||A.span||X,L=parseInt(A.lg)||S,R=parseInt(A.xl)||L,N=parseInt(A.xxl)||R;return D<=c.LG?b+=S:D<c.XL?b+=L:D<c.XXL?b+=R:b+=N,C?(n.hideAdvanceBtn=!1,b<=X*2?(n.hideAdvanceBtn=!0,n.isAdvanced=!0):b>X*2&&b<=X*(t(s).autoAdvancedLine||3)?n.hideAdvanceBtn=!1:n.isLoad||(n.isLoad=!0,n.isAdvanced=!n.isAdvanced),{isAdvanced:n.isAdvanced,itemColSum:b}):b>X*(t(s).alwaysShowLines||1)?{isAdvanced:n.isAdvanced,itemColSum:b}:{isAdvanced:!0,itemColSum:b}}const d=We({});function V(){var D;let A=0,b=0;const{baseColProps:C={}}=t(s);for(const S of t(o)){const{show:L,colProps:R}=S;let N=!0;if(at(L)&&(N=L),ue(L)&&(N=L({schema:S,model:h,field:S.field,values:_(_({},t(p)),h)})),N&&(R||C)){const{itemColSum:W,isAdvanced:H}=O(_(_({},C),R),A);A=W||0,H&&(b=A),d[S.field]=H}}(D=f==null?void 0:f.proxy)==null||D.$forceUpdate(),n.actionSpan=b%X+t(w),O(t(s).actionColOptions||{span:X},A,!0),r("advanced-change")}function m(){n.isAdvanced=!n.isAdvanced}return{handleToggleAdvanced:m,fieldsIsAdvancedMap:d}}function pt(n,r={}){const s=/^\[(.+)\]$/;if(s.test(n)){const o=n.match(s);if(o&&o[1]){const h=o[1].split(",");if(!h.length)return;const p=[];return h.forEach((f,g)=>{z(p,g,r[f.trim()])}),p.filter(Boolean).length?p:void 0}}}function ht(n,r={}){const s=/^\{(.+)\}$/;if(s.test(n)){const o=n.match(s);if(o&&o[1]){const h=o[1].split(",");if(!h.length)return;const p={};return h.forEach(f=>{z(p,f.trim(),r[f.trim()])}),Object.values(p).filter(Boolean).length?p:void 0}}}function mt({emit:n,getProps:r,formModel:s,getSchema:o,defaultValueRef:h,formElRef:p,schemaRef:f,handleFormValues:g}){function c(){return x(this,null,function*(){const{resetFunc:e,submitOnReset:a}=t(r);e&&ue(e)&&(yield e()),t(p)&&(Object.keys(s).forEach(i=>{const F=t(o).find(B=>B.field===i),y=F==null?void 0:F.defaultValueObj,j=Object.keys(y||{});j.length&&j.forEach(B=>{s[B]=y[B]}),s[i]=yt(F,h,i)}),ve(()=>R()),n("reset",Ve(s)),a&&W())})}const u=()=>t(o).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function w(e){return x(this,null,function*(){if(Object.keys(e).length===0)return;const a=u(),v=".",i=a.filter(y=>String(y).indexOf(v)>=0),F=[];a.forEach(y=>{const j=t(o).find(I=>I.field===y);let B=Ae(e,y);const ee=Reflect.has(e,y);B=Qe(j==null?void 0:j.component,B);const{componentProps:te}=j||{};let $=te;typeof te=="function"&&($=$({formModel:t(s),formActionType:H}));const ne=pt(y,e)||ht(y,e),se=I=>I?$!=null&&$.valueFormat?I:q(I):null;if(ee||ne){const I=ne||B;if(C(y))if(Array.isArray(I)){const K=[];for(const l of I)K.push(se(l));t(s)[y]=K}else t(s)[y]=se(I);else t(s)[y]=I;$!=null&&$.onChange&&($==null||$.onChange(I)),F.push(y)}else i.forEach(I=>{try{const K=I.split(".").reduce((l,P)=>l[P],e);Oe(K)&&(t(s)[I]=t(K),F.push(I))}catch(K){Oe(h.value[I])&&(t(s)[I]=G(t(h.value[I])))}})}),D(F).catch(y=>{})})}function E(e){return x(this,null,function*(){const a=G(t(o));if(!e)return;let v=fe(e)?[e]:e;fe(e)&&(v=[e]);for(const i of v)O(i,a);f.value=a})}function O(e,a){if(fe(e)){const v=a.findIndex(i=>i.field===e);v!==-1&&(delete s[e],a.splice(v,1))}}function d(e,a,v=!1){return x(this,null,function*(){const i=G(t(o)),F=Array.isArray(e)?e.map(B=>B.field):[e.field];if(i.find(B=>F.includes(B.field))){ye("There are schemas that have already been added");return}const y=i.findIndex(B=>B.field===a),j=U(e)?[e]:e;!a||y===-1||v?v?i.unshift(...j):i.push(...j):y!==-1&&i.splice(y+1,0,...j),f.value=i,A(e)})}function V(e){return x(this,null,function*(){let a=[];if(U(e)&&a.push(e),M(e)&&(a=[...e]),!a.every(i=>le(i.component)||Reflect.has(i,"field")&&i.field)){ye("All children of the form Schema array that need to be updated must contain the `field` field");return}f.value=a})}function m(e){return x(this,null,function*(){let a=[];if(U(e)&&a.push(e),M(e)&&(a=[...e]),!a.every(y=>le(y.component)||Reflect.has(y,"field")&&y.field)){ye("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[],F=[];t(o).forEach(y=>{const j=a.find(B=>y.field===B.field);if(j){const B=Le(y,j);F.push(B),i.push(B)}else i.push(y)}),A(F),f.value=ot(i,"field")})}function A(e){let a=[];U(e)&&a.push(e),M(e)&&(a=[...e]);const v={},i=b();a.forEach(F=>{!le(F.component)&&Reflect.has(F,"field")&&F.field&&!Q(F.defaultValue)&&(!(F.field in i)||Q(i[F.field]))&&(v[F.field]=F.defaultValue)}),w(v)}function b(){return t(p)?g(Ve(t(s))):{}}function C(e){return t(o).some(a=>a.field===e&&a.component?Pe.includes(a.component):!1)}function D(e){return x(this,null,function*(){var v;const a=yield(v=t(p))==null?void 0:v.validateFields(e);return g(a)})}function S(e){return x(this,null,function*(){var a;yield(a=t(p))==null?void 0:a.setProps(e)})}function L(e){return x(this,null,function*(){var i;let a;e===void 0?a=u():a=e===Array.isArray(e)?e:void 0;const v=yield(i=t(p))==null?void 0:i.validate(a);return g(v)})}function R(e){return x(this,null,function*(){var a;yield(a=t(p))==null?void 0:a.clearValidate(e)})}function N(e,a){return x(this,null,function*(){var v;yield(v=t(p))==null?void 0:v.scrollToField(e,a)})}function W(e){return x(this,null,function*(){e&&e.preventDefault();const{submitFunc:a}=t(r);if(a&&ue(a)){yield a();return}if(t(p))try{const i=yield L();n("submit",i)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i!=null&&i.errorFields))return;throw new Error(i)}})}const H={getFieldsValue:b,setFieldsValue:w,resetFields:c,updateSchema:m,resetSchema:V,setProps:S,removeSchemaByField:E,appendSchemaByField:d,clearValidate:R,validateFields:D,validate:L,submit:W,scrollToField:N};return{handleSubmit:W,clearValidate:R,validate:L,validateFields:D,getFieldsValue:b,updateSchema:m,resetSchema:V,appendSchemaByField:d,removeSchemaByField:E,resetFields:c,setFieldsValue:w,scrollToField:N}}function yt(n,r,s){let o=G(r.value[s]);return vt(n)?o||void 0:(!o&&n&&At(n)&&(o=[0,0]),!o&&n&&n.component==="ApiTree"&&(o=[]),o)}function At(n){if(n.component==="Slider"&&n.componentProps&&"range"in n.componentProps)return!0}function vt(n){return(n==null?void 0:n.component)&&et.includes(n.component)}function gt(h){return x(this,arguments,function*({getSchema:n,getProps:r,formElRef:s,isInitedDefault:o}){Ke(()=>x(this,null,function*(){if(t(o)||!t(r).autoFocusFirstItem)return;yield ve();const p=t(n),f=t(s),g=f==null?void 0:f.$el;if(!f||!g||!p||p.length===0)return;const c=p[0];if(!c.component||!c.component.includes("Input"))return;const u=g.querySelector(".ant-row:first-child input");u&&(u==null||u.focus())}))})}const Dt=Ue({name:"BasicForm",__name:"BasicForm",props:Je,emits:["advanced-change","reset","submit","register","field-value-change"],setup(n,{expose:r,emit:s}){const o=n,h=s,p=qe(),f=Ie({}),g=ct(),c=Ie({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),u=J({}),w=J(!1),E=J(),O=J(null),d=J(null),{prefixCls:V}=nt("basic-form"),m=Y(()=>_(_({},o),t(E))),A=Y(()=>[V,{[`${V}--compact`]:t(m).compact}]),b=Y(()=>{const{baseRowStyle:l={},rowProps:P}=t(m);return _({style:l},P)}),C=Y(()=>_(_(_({},p),o),t(m))),D=Y(()=>{var P;const l=G(t(O)||t(m).schemas);for(const T of l){const{defaultValue:k,component:ae,componentProps:oe={},isHandleDateDefaultValue:$e=!0}=T;if($e&&k&&ae&&Pe.includes(ae)){const Se={schema:T,tableAction:(P=o.tableAction)!=null?P:{},formModel:f,formActionType:{}},ie=oe?typeof oe=="function"?oe(Se).valueFormat:oe.valueFormat:null;if(!Array.isArray(k))T.defaultValue=ie?q(k).format(ie):q(k);else{const ge=[];k.forEach(be=>{ge.push(ie?q(be).format(ie):q(be))}),T.defaultValue=ge}}}return t(m).showAdvancedButton?l.filter(T=>!le(T.component)):l}),{handleToggleAdvanced:S,fieldsIsAdvancedMap:L}=dt({advanceState:c,emit:h,getProps:m,getSchema:D,formModel:f,defaultValueRef:u}),{handleFormValues:R,initDefault:N}=ut({getProps:m,defaultValueRef:u,getSchema:D,formModel:f});gt({getSchema:D,getProps:m,isInitedDefault:w,formElRef:d});const{handleSubmit:W,setFieldsValue:H,clearValidate:e,validate:a,validateFields:v,getFieldsValue:i,updateSchema:F,resetSchema:y,appendSchemaByField:j,removeSchemaByField:B,resetFields:ee,scrollToField:te}=mt({emit:h,getProps:m,formModel:f,getSchema:D,defaultValueRef:u,formElRef:d,schemaRef:O,handleFormValues:R});Ze({resetAction:ee,submitAction:W}),Z(()=>t(m).model,()=>{const{model:l}=t(m);l&&H(l)},{immediate:!0}),Z(()=>o.schemas,l=>{y(l!=null?l:[])}),Z(()=>D.value,l=>{ve(()=>{var P;(P=g==null?void 0:g.redoModalHeight)==null||P.call(g)}),!t(w)&&l!=null&&l.length&&(N(),w.value=!0)}),Z(()=>f,_e(()=>{t(m).submitOnChange&&W()},300),{deep:!0});function $(l){return x(this,null,function*(){E.value=Le(t(E)||{},l)})}function ne(l,P,T){f[l]=P,h("field-value-change",l,P),T&&T.itemProps&&!T.itemProps.autoLink&&v([l]).catch(k=>{})}function se(l){const{autoSubmitOnEnter:P}=t(m);if(P&&l.key==="Enter"&&l.target&&l.target instanceof HTMLElement){const T=l.target;T&&T.tagName&&T.tagName.toUpperCase()==="INPUT"&&W()}}const I={getFieldsValue:i,setFieldsValue:H,resetFields:ee,updateSchema:F,resetSchema:y,setProps:$,removeSchemaByField:B,appendSchemaByField:j,clearValidate:e,validateFields:v,validate:a,submit:W,scrollToField:te},K=Y(()=>_(_({},m.value),c));return r(_({},I)),He(()=>{N(),h("register",I)}),(l,P)=>(de(),Be(t(rt),De(C.value,{class:A.value,ref_key:"formElRef",ref:d,model:f,onKeypress:ze(se,["enter"])}),{default:re(()=>[Te(t(it),he(me(b.value)),{default:re(()=>[ce(l.$slots,"formHeader"),(de(!0),Xe(Ye,null,pe(D.value,T=>(de(),Be(Ge,{key:T.field,isAdvanced:t(L)[T.field],tableAction:l.tableAction,formActionType:I,schema:T,formProps:m.value,allDefaultValues:u.value,formModel:f,setFormModel:ne},Ee({_:2},[pe(Object.keys(l.$slots),k=>({name:k,fn:re(ae=>[ce(l.$slots,k,he(me(ae||{})))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Te(Me,De(K.value,{onToggleAdvanced:t(S)}),Ee({_:2},[pe(["resetBefore","submitBefore","advanceBefore","advanceAfter"],T=>({name:T,fn:re(k=>[ce(l.$slots,T,he(me(k||{})))])}))]),1040,["onToggleAdvanced"]),ce(l.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model"]))}});export{Dt as _};
